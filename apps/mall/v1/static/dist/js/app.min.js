$(document).ready(function(){$("body").on("click","[data-mesh-action]",function(e){e.preventDefault();var $this=$(this),action=$(this).data("mesh-action");switch(action){case"sidebar-open":var target=$this.data("ma-target"),backdrop='<div data-mesh-action="sidebar-close" class="ma-backdrop" />';$("body").addClass("sidebar-toggled"),$("#header, #header-alt, #main").append(backdrop),$this.addClass("toggled"),$(target).addClass("toggled");break;case"sidebar-close":$("body").removeClass("sidebar-toggled"),$(".ma-backdrop").remove(),$(".sidebar, .ma-trigger").removeClass("toggled");break;case"profile-menu-toggle":$this.parent().toggleClass("toggled"),$this.next().slideToggle(200);break;case"login-switch":var loginblock=$this.data("ma-block"),loginParent=$this.closest(".lc-block");loginParent.removeClass("toggled"),setTimeout(function(){$(loginblock).addClass("toggled")});break;case"login":var userName=$("#login_user").val(),needRemember=($("#login_pass").val(),$("#login_remember").is(":checked"));needRemember&&_Utils.setStorage("user",{name:userName});var loginUrl="/api/users";$.ajax({url:loginUrl,dataType:"json",type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify({name:userName}),success:function(data){_Utils.setCookie("user",userName,1),_Utils.gotoPage("index")},error:function(err){_Utils.delCookie("user")}});break;case"logout":_Utils.delCookie("user"),_Utils.gotoPage("login");break;case"fresh-page":_Utils.freshPage();break;case"goto-login":_Utils.gotoPage("login")}})}),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&$("html").addClass("ismobile"),$(window).load(function(){$("html").hasClass("ismobile")||$(".page-loader")[0]&&setTimeout(function(){$(".page-loader").fadeOut()},500)}),$(document).ready(function(){$(".fg-line")[0]&&($("body").on("focus",".fg-line .form-control",function(){$(this).closest(".fg-line").addClass("fg-toggled")}),$("body").on("blur",".form-control",function(){var p=$(this).closest(".form-group, .input-group"),i=p.find(".form-control").val();p.hasClass("fg-float")?0==i.length&&$(this).closest(".fg-line").removeClass("fg-toggled"):$(this).closest(".fg-line").removeClass("fg-toggled")})),$(".fg-float")[0]&&$(".fg-float .form-control").each(function(){var i=$(this).val();0==!i.length&&$(this).closest(".fg-line").addClass("fg-toggled")}),$("body").on("click",".a-prevent",function(e){e.preventDefault()})}),$(document).ready(function(){var pageId=_Utils.getPageName();switch(pageId){case"index":var getAllURL=(_Utils.getCookie("user"),"/api/all"),changeName=function(name){$("#logined_user_name").text(name)},changeProducts=function(data){var productListDom=$("#product_list"),productList="",productsArr=data.products&&data.products[0]?data.products:[],bannerImg=data.banner?data.banner:"";bannerImg&&$("#product_banner").html('<img loading="lazy" src="'+bannerImg+'" style="width:100%;height:130px;">'),productsArr.forEach(function(row){productList+='<div class="col-sm-2 col-xs-6"><div class="thumbnail" style="background-color:#fff"><img src="'+row.image+'" alt="" style="height: 120px;"><div class="caption"><h5 style="max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+row.title+'">'+(row.title?row.title:"-")+'</h5><hr /><p style="color:#e01222;margin-bottom:5px;"><i class="zmdi zmdi-money "></i> <span style="font-size: 24px">'+row.price+'</span> <span style="color:#999">(已售: <span style="color: #5e5e5e;font-weight:bold">'+row.sales+"</span>/"+row.stock+")</span></p>",row.favorites&&(productList+='<i class="zmdi zmdi-star-outline "></i> '+row.favorites+" 人收藏"),productList+="</div></div></div>"}),productListDom.html(productList)},_getStars=function(score){return'<i class="zmdi zmdi-star"></i>'.repeat(Math.floor(Math.round(score)/2))},changeRecommends=function(rdata){var r_productListDom=$("#recommend_product_list"),r_productList="",r_productsArr=rdata.products&&rdata.products[0]?rdata.products:[],bannerImg=rdata.banner?rdata.banner:"";bannerImg&&$("#recommend_product_banner").html('<img loading="lazy" src="'+bannerImg+'" style="width:100%;height:130px;">'),r_productsArr=r_productsArr.sort(function(a,b){return b.score-a.score}),r_productsArr.forEach(function(row){r_productList+='<div class="col-sm-2 col-xs-6"><div class="thumbnail" style="background-color:#fff"><img src="'+row.image+'" alt="" style="height: 120px;"><div class="caption"><h5 style="max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+(row.title?row.title:"-")+'</h5><hr /><p style="color:#e01222;margin-bottom:5px;"><i class="zmdi zmdi-money "></i> <span style="font-size: 24px">'+row.price+'</span> <span style="color:#999">(已售: <span style="color: #5e5e5e;font-weight:bold">'+row.sales+"</span>/"+row.stock+")</span></p>",row.score&&(r_productList+=_getStars(row.score)+" "+row.score+" 分"),r_productList+="</div></div></div>"}),r_productListDom.html(r_productList)};$.ajax({type:"GET",url:getAllURL,data:null,success:function(all_data){all_data.user.name?(changeName(all_data.user.name),$("#user_name_wrapper").show(),$("#login_wrapper").hide(),$("#logout_wrapper").show()):($("#user_name_wrapper").hide(),$("#login_wrapper").show(),$("#logout_wrapper").hide()),changeProducts(all_data.discount||null),changeRecommends(all_data.recommend||null)},error:function(data){console.warn("请求失败")}});break;case"login":}});var _Utils=function(){var pages=["index","login"];return{setCookie:function(name,value,days){var expires;if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"},getCookie:function(c_name){return document.cookie.length>0&&(c_start=document.cookie.indexOf(c_name+"="),c_start!=-1)?(c_start=c_start+c_name.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""},delCookie:function(name){_Utils.setCookie(name,"",-1)},setStorage:function(key,value){window.localStorage.setItem(key,JSON.stringify(value))},removeStorage:function(key){window.localStorage.removeItem(key)},getStorage:function(key){var v=window.localStorage.getItem(key)||null;return v&&(v=JSON.parse(v)),v},clearStorage:function(){window.localStorage.clear()},getPageName:function(){var page=$("body").data("p-id");return pages.indexOf(page)>-1?page:"others"},gotoPage:function(page){pages.indexOf(page)>-1?window.location.replace("/"+page):window.location.replace("/login")},freshPage:function(){window.location.reload()}}}();